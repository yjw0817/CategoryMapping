# Category Mapping Automation

11번가 쇼핑몰 카테고리 매핑 및 상품 수집 자동화 도구 (개인용 버전)

## 🎯 주요 기능

### 1. 사이트 대량상품수집
- CSV 파일에서 URL 목록 읽기
- 각 카테고리별 상품 수집 조건 자동 생성
- Chrome 확장 프로그램을 통한 실제 수집 작업 수행

### 2. 카테고리 매핑
- 수집된 상품의 카테고리 자동 매핑
- 매핑 규칙 적용 및 검증

### 3. 수집조건 수정 ⭐ NEW
- 검색어로 필터 조회
- 목표 수집수와 현재 수집수 비교
- 이미 목표 도달한 항목 자동 스킵
- 페이징 처리 (100개씩 자동 처리)

## 🔧 기술 스택

- **Node.js** v18+
- **Playwright** - CDP 연결을 통한 브라우저 자동화
- **Chrome DevTools Protocol (CDP)** - 확장 프로그램 사용 가능
- **CSV Parser** - 대량 데이터 처리
- **Inquirer** - CLI 인터랙티브 메뉴

## 📋 사전 요구사항

- Node.js v18 이상
- Google Chrome 브라우저
- 관리자 계정 로그인 상태

## 🚀 설치 방법

### 1. 저장소 클론
```bash
git clone <repository-url>
cd CategoryMapping
```

### 2. 의존성 설치
```bash
npm install
```

### 3. 환경 변수 설정 (선택사항)
```bash
# .env 파일 생성 (필요시)
```

## 💻 사용 방법

### Chrome 실행 (CDP 모드)
```powershell
# PowerShell에서 실행
.\크롬시작.ps1
```

이 명령어는:
- Chrome을 디버깅 포트(9223)로 실행
- 기존 프로필 사용 (로그인 세션 유지)
- 확장 프로그램 활성화 상태 유지

### 프로그램 실행
```bash
# 메인 메뉴 실행
npm run process

# 또는 직접 실행
node process-categories.js
```

## 📖 메뉴 설명

### 1. 사이트 대량상품수집
1. CSV 파일 선택
2. 수집 조건 설정
3. 자동 수집 시작

**CSV 형식:**
```csv
카테고리명,URL,수집개수
등산 잡화,https://www.11st.co.kr/...,200
보호장비,https://www.11st.co.kr/...,200
```

### 2. 카테고리 매핑
- TBD (개발 예정)

### 3. 수집조건 수정 ⭐
1. 검색어 입력 (예: "섬김Trade0")
2. 목표 수집수 입력 (예: 200)
3. 확인 (Y/N)
4. 자동 처리:
   - 100개씩 보기로 자동 변경
   - 각 필터의 (수집개수 + 저장된 수집수) 확인
   - 목표 미달 항목만 수정
   - 모든 페이지 자동 처리

**로직:**
```
if (수집개수 + 저장된 수집수) < 목표 수집수:
    새로운 저장 수집수 = 목표 수집수 - 수집개수
    수정 진행
else:
    건너뛰기 (이미 목표 도달)
```

## 🏗️ 프로젝트 구조

```
CategoryMapping/
├── process-categories.js      # 메인 프로그램
├── login.js                   # 로그인 자동화 (미사용)
├── 크롬시작.ps1                # Chrome CDP 실행 스크립트
├── package.json               # 의존성 관리
├── category.csv               # 카테고리 데이터
├── failed_items.csv           # 실패 항목 기록
├── failed_mappings.json       # 실패 매핑 기록
├── errors.json                # 에러 로그
├── last_attempted_id.txt      # 마지막 처리 ID
└── 상품 카테고리 수집 URL/     # CSV 파일 폴더
```

## 🔍 주요 함수

### `modifyCollectionConditions(page)`
수집조건 수정 메인 함수
- 페이징 처리
- 목표 달성 여부 확인
- 자동 스킵 로직

### `bulkCollectFromCSV(context, page)`
CSV 기반 대량 수집
- CSV 파일 읽기
- 수집 조건 생성
- 진행 상태 저장

## ⚠️ 주의사항

1. **Chrome CDP 연결 필수**
   - 반드시 `크롬시작.ps1`로 Chrome 실행
   - 포트: 9223
   - **이유: Chrome 확장 프로그램 사용을 위함**

2. **확장 프로그램**
   - 수집 자동화 확장 프로그램 설치 필요
   - 프로필에 로그인 상태 유지

3. **관리자 권한**
   - 쇼핑몰 관리자 계정 로그인 필요

4. **파일 권한**
   - CSV 파일 읽기 권한
   - 로그 파일 쓰기 권한

## 🐛 문제 해결

### Chrome 연결 실패
```powershell
# Chrome 프로세스 종료
taskkill /F /IM chrome.exe

# 다시 시작
.\크롬시작.ps1
```

### 팝업이 열리지 않음
- 팝업 차단 해제 확인
- Chrome 업데이트 확인

### CSV 읽기 오류
- 파일 인코딩: UTF-8 with BOM
- 줄바꿈: CRLF (Windows)

## 📝 개발 로그

### v1.0.0 (2025-01-06)
- ✅ 메뉴 3: 수집조건 수정 완전 구현
- ✅ 스마트 스킵 로직 (목표 달성 항목 자동 제외)
- ✅ 페이징 처리 (100개씩 자동)
- ✅ 수집개수 + 저장된 수집수 비교 로직
- ✅ CDP 연결 방식으로 확장 프로그램 사용 가능

### v0.2.0
- ✅ CSV 기반 대량 수집 구현
- ✅ 에러 핸들링 및 재시도 로직

### v0.1.0
- ✅ 기본 프로젝트 구조
- ✅ CDP 연결 설정

## 🔮 향후 계획

이 프로젝트는 **개인용 버전**입니다.

**상용화 버전**은 별도 프로젝트로 개발 예정:
- 웹 SaaS 형태 (React/Vue 대시보드)
- 로컬 Agent + 웹 서버 구조
- 구독 관리 시스템 (월 29,000~59,000원)
- 자동 업데이트 기능
- CDP 연결 방식 유지 (확장 프로그램 지원)

## 📄 라이선스

개인용 프로젝트 - 상업적 사용 금지

## 👤 작성자

개인 프로젝트

---

**Note**: 이 README는 개인용 버전입니다. 상용화 버전은 별도 저장소에서 개발됩니다.
